<!DOCTYPE html>
<html>
<head>
    <title>Measure</title>
    <link rel="stylesheet" href="./css/ol.css" type="text/css">
    <script src="./js/ol.js" type="text/javascript"></script>
    <style>
        .tooltip {
            position: relative;
            background: rgba(184, 25, 94, 0.8);
            border-radius: 4px;
            color: white;
            padding: 4px 8px;
            opacity: 0.8;
            white-space: nowrap;
        }

    </style>
</head>
<body>
<div id="map" class="map"></div>

<script>


    var features = new ol.Collection();
    var source = new ol.source.Vector({features: features});
    var vector = new ol.layer.Vector({
        source: source,
        style: new ol.style.Style({

            image: new ol.style.Icon({
                anchor: [0.5, 66],
                anchorXUnits: 'fraction',
                anchorYUnits: 'pixels',
                opacity: 0.90,
                src: 'images/marker.png',
                //scale: 0.7
            })
        })
    });

    var lastFeature;


    /**
     * The help tooltip element.
     * @type {Element}
     */
    var helpTooltipElement;


    /**
     * Overlay to show the help messages.
     * @type {ol.Overlay}
     */
    var helpTooltip;


    var removeLastFeature = function () {
        if (lastFeature) source.removeFeature(lastFeature);
    };


    /**
     * Handle pointer move.
     * @param {ol.MapBrowserEvent} evt The event.
     */
    var pointerMoveHandler = function (evt) {
        if (evt.dragging) {
            return;
        }
        var helpMsg = 'Cliquez pour localiser le projet';

        helpTooltipElement.innerHTML = helpMsg;
        helpTooltip.setPosition(evt.coordinate);

        helpTooltipElement.style.visibility = "visible";
    };


    var raster = new ol.layer.Tile({
        source: new ol.source.OSM()
    });

    var map = new ol.Map({
        layers: [raster, vector],
        target: 'map',
        view: new ol.View({
            center: [-11000000, 4600000],
            zoom: 4
        })
    });


    map.on('pointermove', pointerMoveHandler);

    map.getViewport().addEventListener('mouseout', function () {
        //vector.setOpacity(0.3);
        helpTooltipElement.style.visibility = "hidden";
    });


    var draw; // global so we can remove it later


    function addInteraction() {
        var type = 'Point';
        draw = new ol.interaction.Draw({
            source: source,
            type: /** @type {ol.geom.GeometryType}  */ (type),
            style: new ol.style.Style({
                image: new ol.style.Circle({
                    radius: 5,
                    stroke: new ol.style.Stroke({
                        color: 'rgba(255, 0, 0, 1)'
                    }),
                    fill: new ol.style.Fill({
                        color: 'rgba(255, 0, 0, 0.1)'
                    })
                })
            })
        });

        draw.on('drawend', function (e) {
            removeLastFeature();
            lastFeature = e.feature;
        });

        map.addInteraction(draw);
        map.on('click', function (evt) {
            //vector.setOpacity(0.5);
            console.log("clique");

        });
        createHelpTooltip();


    }


    /**
     * Creates a new help tooltip
     */
    function createHelpTooltip() {

        helpTooltipElement = document.createElement('div');
        helpTooltipElement.className = 'tooltip';
        helpTooltip = new ol.Overlay({
            element: helpTooltipElement,
            offset: [15, 0],
            positioning: 'bottom'
        });
        map.addOverlay(helpTooltip);
    }


    addInteraction();
</script>
</body>
</html>